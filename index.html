<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">	
	<title>Dotas Sistemas</title>
	<link rel="stylesheet" type="text/css" href="src/easyui/themes/bootstrap/easyui.css">
	<link rel="stylesheet" type="text/css" href="src/easyui/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="src/style.css">
	<link rel="stylesheet" type="text/css" href="src/icons_new/icons.css">

	<link rel="stylesheet" type="text/css" href="src/desktop.css">
	<link rel="stylesheet" type="text/css" href="src/texteditor.css">	
	
	<script type="text/javascript" src="src/jquery.min.js"></script>
	<script type="text/javascript" src="src/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="src/jquery.desktop.js"></script>
	<script type="text/javascript" src="src/jquery.portal.js"></script>
	<script type="text/javascript" src="src/datagrid-filter.js"></script>
	<script type="text/javascript" src="src/easyui.dialogform.js"></script>	
	<script type="text/javascript" src="src/easyui.datagridmysql.js"></script>

	<script type="text/javascript" src="src/easyui/locale/easyui-lang-pt_BR.js"></script>


	<script type="text/javascript">
		var server = {}
		$(function(){

			if(localStorage.getItem('theme')){
				var themes = localStorage.getItem('theme');
				var link = $('head').find('link:first');
				link.attr('href', 'src/easyui/themes/'+themes+'/easyui.css');
			}else{
				localStorage.setItem('theme','bootstrap')
			}


			if(localStorage.getItem('wallpaper')){
				var wallpaper = localStorage.getItem('wallpaper');
				//$('body').desktop('setWallpaper', wallpaper);
			}else{
				localStorage.setItem('wallpaper','wallpaper/bg (14).jpg')
			}


	


			
			$.getJSON( "server.php?op=modulos_config", function( data ) {
			  server = data;
			}).always(function(data) {

				//console.log(data);

				if(!data.session.login){
					$().dialogForm({
						href:'modulos/login/form.html',
						closable:false,
						saveble:false,	
						cls:'dialog_login',
						buttons:[{
							text:'ENTRAR',
							iconCls:'lock_open_32',
							handler:function(){
									$.messager.progress();
									$.getJSON( "server.php?op=logar&login="+$('.login').textbox('getValue')+'&senha='+$('.senha').passwordbox('getValue'), function( data ) {
										
										if(data.error){
											$.messager.alert('Erro',data.error.login); 
										}
										if(data.logado==true){
											$(dialogForm).dialogForm('close'); 
										}
										$.messager.progress('close');
									})



									$('#form_login').form('reset');
								}
							}],
					});
				}

				//////////////////////////////////////////////////////////////
				var menu = [];
				$.each(server.modulos, function( index, value ) {	
					var insert = {};
					insert['text'] = value.name
					insert['iconCls'] = value.iconCls					
					insert['handler'] = function(){
						$('body').desktop('openApp', value)
					}
					menu.push(insert);	
	            });		

				/////////////////////////////////////////////////////////////
				$('body').desktop({
						apps: server.modulos,
						wallpaper:localStorage.getItem('wallpaper'),
						menus: [{
									text: 'Dotas Sistemas',
									iconCls:'www_page_32',
									handler: function(){
										$('body').desktop('openApp', {
											icon: 'images/win.png',
											name: 'Quem Somos',
											width: 400,
											height: 200,
											href: '_about.html'
										})
									}
								},{
									text: 'Modulos',
									iconCls:'plugin_32',
									menus: menu
								},{
									text: 'Configurações',
									iconCls: 'cog_32',
									handler: function(){
										settings()
									}
								},{
									text: 'Logout',
									iconCls: 'icon-lock',
									handler: function(){
										$.messager.confirm({
											title:'Confirmar',
											msg:'Deseja fazer logout?',
											border: 'thin',
											fn:function(){
												$.getJSON( "server.php?op=logout", function( data ) {
										
													document.location.reload(true);
													
												})
											}
										})
									}
								}],
								buttons: '#buttons'
							})
						});	
			});



		settingsApp = null;
		function settings(){
			if (settingsApp){
				$('body').desktop('openApp', settingsApp);
				return;
			}
			settingsApp = {
				id: 'settings',
				name: 'Configurações',
				width: 600,
				height: 400,
				onBeforeClose: function(){
					settingsApp = null;
				}
			};
			$('body').desktop('openApp', settingsApp);
			var template = '<div>' +
				'<div region="north" style="padding:5px;height:45px;text-align:right"></div>' +
				'<div region="south" style="text-align:right;height:45px;padding:5px"></div>' +
				'<div region="west" title="Fundo" split="true" style="width:200px"><table id="settings-dl"></table></div>' +
				'<div region="center" title="Pré-visualização"><img id="settings-img" style="border:0;width:100%;height:100%"></div>' +
				'</div>';
			var layout = $(template).appendTo('#settings');
			layout.layout({
				fit: true
			});





			var combo = $('<input>').appendTo(layout.layout('panel','north'));
			combo.combobox({
				data: [
					{value:'default',text:'Default',group:'Base'},
					{value:'gray',text:'Gray',group:'Base'},
					{value:'metro',text:'Metro',group:'Base'},
					{value:'material',text:'Material',group:'Base'},
					{value:'material-teal',text:'Material Teal',group:'Base'},
					{value:'bootstrap',text:'Bootstrap',group:'Base'},
					{value:'black',text:'Black',group:'Base'},
				],
				width: 300,
				label: 'Tema: ',
				value: localStorage.getItem('theme'),
				editable:false,
				panelHeight: 'auto',
				onChange: function(theme){
					var link = $('head').find('link:first');
					localStorage.setItem('theme', theme);
					link.attr('href', 'src/easyui/themes/'+theme+'/easyui.css');					
				}
			});

			//console.log(server.wallpapers)

			$('#settings-dl').datalist({
				fit: true,
				data: server.wallpapers,
				onLoadSuccess:function(){
					$(this).datalist('selectRow', 0);
				},
				onSelect(index,row){
					$('#settings-img').attr('src', row.img)
				}
			});

			var getData = $('#settings-dl').datalist('getData');
			$.each(getData.rows, function( index, values ) {	
				if(values.img==localStorage.getItem('wallpaper')){
					$('#settings-dl').datalist('selectRow',index)
				};	
            });		

			$('<a style="margin-right:10px"></a>').appendTo(layout.layout('panel','south')).linkbutton({
				text: 'Salvar',
				width: 80,
				onClick: function(){
					localStorage.setItem('wallpaper_text', $('#settings-dl').datalist('getSelected').img);
					localStorage.setItem('wallpaper', $('#settings-dl').datalist('getSelected').img);
					$('body').desktop('setWallpaper', $('#settings-dl').datalist('getSelected').img);
					$('#settings').window('close');
				}
			})
			$('<a></a>').appendTo(layout.layout('panel','south')).linkbutton({
				text: 'Cancelar',
				width: 80,
				onClick: function(){
					$('#settings').window('close');
				}
			})
		}









	</script>
</head>
<body style="background-color:#aaa">
	<div id="buttons">
		<!--<a href="javascript:;" class="easyui-linkbutton" iconCls='cog_32' outline="true" plain="true" onclick="settings()">CONFIGURAÇÕES</a>-->
	</div>
	<script type="text/javascript" src="src/scripts.js"></script>	
	<script type="text/javascript" src="src/default.easyui.js"></script>
	<script type="text/javascript">
		
	</script>

</body>
</html>